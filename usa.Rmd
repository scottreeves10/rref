---
title: "Mapping - United States"
author: Scott Reeves
# date: 2018-05-20
output: 
  html_document 
    # toc: true
    # toc_float: true
---

```{r setup, include=FALSE}
set.seed(1014)
#options(digits = 3)

knitr::opts_chunk$set(comment = "#>",collapse = TRUE,cache = TRUE, fig.path = "images/",out.width = "100%",fig.align = 'center',fig.width = 10,fig.asp = 0.618)

options(dplyr.print_min = 5, dplyr.print_max = 5)
```

# Sources and References


[Shapefiles - States](https://www.census.gov/geo/maps-data/data/cbf/cbf_state.html)

[About creating tmap insets for AK and HI](https://github.com/mtennekes/tmap/tree/master/demo/USChoropleth)

[Leaflet Providers](http://leaflet-extras.github.io/leaflet-providers/preview/)



# Libraries

```{r message=FALSE, warning=FALSE}

library(sf)
library(tidyverse)
library(stringr)

# While running R as the administrator, reinstall ggplot2 like this:
# 
# devtools::install_github("tidyverse/ggplot2")
# require(ggplot2)

library(ggplot2)
library(tmap)

```

## Data

```{r}


states <- st_read("F:/datasets/uscensus/cb_2017_us_state_5m/cb_2017_us_state_5m.shp")

zipcodes <- st_read("F:/datasets/uscensus/cb_2017_us_zcta510_500k/cb_2017_us_zcta510_500k.shp", stringsAsFactors = FALSE)

```

```{r}
glimpse(states)
```

```{r}
levels(states$NAME)
```



```{r}
outside48 <- c("Alaska", "Hawaii", "Puerto Rico", "American Samoa", "United States Virgin Islands", "Guam", "Commonwealth of the Northern Mariana Islands")

contig48dc <- filter(states, !(NAME %in% outside48))
```



```{r}
qtm(contig48dc)
```


```{r}
tmap_mode(mode = "plot")

tm_shape(contig48dc) +
  tm_polygons(col = "MAP_COLORS")

```


```{r message=FALSE}
tmap_mode(mode = "view")
tm_shape(contig48dc) + tm_polygons(alpha = 0) + 
  tm_shape(zipcodes303s) + tm_polygons(alpha = .5) + 
  tm_view(basemaps = 'Esri.NatGeoWorldMap')

```


```{r}
glimpse(zipcodes)
```



```{r}

# value = TRUE is necessary to pull the values rather than the item's vector position
zips303s <- grep("^303", zipcodes$ZCTA5CE10, value = TRUE)

# this also works
# zipcodes303s <- zipcodes %>% filter(ZCTA5CE10 >= "30300" & ZCTA5CE10 <= "30399")

zipcodes303s <- zipcodes %>% filter(ZCTA5CE10 %in% zips303s)

```

```{r}
qtm(zipcodes303s)
```



